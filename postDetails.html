<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <!-- import bootstrap -->
    <script src="./node_modules/bootstrap/dist/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="./node_modules/bootstrap/dist/css/bootstrap.min.css">
    <!-- import axios -->
    <script src="./node_modules/axios/dist/axios.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <!-- ======== LOADER ======== -->
    <div id="loader"
        style="background:rgba(128, 128, 128, 0.45) ; position: fixed; top:0px; bottom: 0px; left: 0px; right: 0px; margin: auto ;display: flex;justify-content: center;align-items: center;z-index: 9999; width: 80px; height: 80px; border-radius:15px; ">
        <div class="lds-roller">
            <div></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>
        </div>
    </div>

    <!-- // ========= LODAER ======== // -->

    <!-- ############ Modal ########## -->

    <!-- Login Modal -->
    <div class="modal fade" id="modal_login" tabindex="-1" aria-labelledby="modalLoginLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="modalLoginLabel">Login</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="mb-3">
                            <label for="recipient-name" class="col-form-label">Username:</label>
                            <input type="text" class="form-control" id="username_input" value="ax8m">
                        </div>
                        <div class="mb-3">
                            <label for="message-text" class="col-form-label">Password:</label>
                            <input type="password" class="form-control" id="password_input" value="a#xm12">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="loginBtn" onclick="loginBtnClick()">
                        Login
                    </button>
                </div>
            </div>
        </div>
    </div>
    <!--// Login Modal //-->

    <!-- Register Modal-->
    <div class="modal fade" id="modal_register" tabindex="-1" aria-labelledby="modalRegisterLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="modalLoginLabel">Register</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="">
                            <label for="message-text" class="col-form-label">Name:</label>
                            <input type="text" class="form-control" id="name_reg">
                        </div>
                        <div class="">
                            <label for="recipient-name" class="col-form-label">Username:</label>
                            <input type="text" class="form-control" id="username_reg" value="ax8m">
                        </div>
                        <div class="">
                            <label for="message-text" class="col-form-label">Email:</label>
                            <input type="email" class="form-control" id="email_reg">
                        </div>
                        <div class="">
                            <label for="message-text" class="col-form-label">Password:</label>
                            <input type="password" class="form-control" id="password_reg" value="a#xm12">
                        </div>
                        <div class="">
                            <label for="message-text" class="col-form-label">Profail image:</label>
                            <input type="file" class="form-control" id="image_reg">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="registerBtn" onclick="registerBtnClick()">
                        Register
                    </button>
                </div>
            </div>
        </div>
    </div>
    <!--// Register Modal //-->

    <!-- Creat Post Modal-->
    <div class="modal fade" id="creat-post-modal" tabindex="-1" aria-labelledby="modalCreatPostLabel"
        aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="modalLoginLabel">Creat A New Post</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="mb-3">
                            <label for="message-text" class="col-form-label">Title:</label>
                            <input type="text" class="form-control" id="post-title-input">
                        </div>


                        <div class="mb-3">
                            <label>Body:</label>
                            <textarea class="" name="" id="post-body-input"></textarea>
                        </div>

                        <div class="mb-2">
                            <label for="message-text" class="col-form-label"> image:</label>
                            <input type="file" class="form-control" id="post-image-input">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="post-add-btn" onclick="creatNewPostClick()">
                        Add
                    </button>
                </div>
            </div>
        </div>
    </div>
    <!--// Creat Post Modal //-->

    <!-- //####### Modal #######// -->

    <!-- ########### Alert ######### -->
    <div id="AlertShows" class="" style=" width: 30%;position: fixed; z-index: 99999; bottom: 0; right: 0;"></div>
    <!--// ########### Alert ######### //-->

    <header class="container">
        <nav class="navbar navbar-expand-lg bg-body-tertiary rounded-4 shadow-sm">
            <div class="container-fluid">
                <a class="navbar-brand" href="Home.html">Tarmeez</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                    data-bs-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false"
                    aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
                    <div class="navbar-nav">
                        <a class="nav-link active" aria-current="page" href="Home.html">Home</a>
                        <a class="nav-link" onclick="profileClicked()" style="cursor:pointer;">Profile</a>
                    </div>


                    <!-- non-logged in user -->
                    <div style="display: flex; justify-content: end;" id="logged-in-div">
                        <button type="button" id="login-btn" class="btn btn-outline-success" data-bs-toggle="modal"
                            data-bs-target="#modal_login">Login</button>
                        <button type="button" id="register-btn" class="btn btn-outline-success" data-bs-toggle="modal"
                            data-bs-target="#modal_register">Register</button>
                    </div>
                    <!-- // non-logged in user // -->



                    <!-- logged in user -->
                    <div style="display: flex; justify-content: end;" id="logout-div">
                        <div class="card-header" style="display: flex;align-items: center;">
                            <img src="./images/profile-logo.png" alt="" id="profile_image" srcset=""
                                style="width: 30px; height: 30px;">
                            <h6 class="mx-2 mt-1" id="user">Axjmr</h6>
                            <button type="button" id="logout-btn" class="btn btn-outline-danger mx-2" onclick="logout()"
                                data-bs-toggle="modal">Logout</button>
                        </div>

                    </div>
                    <!-- // logged in user // -->
                </div>
            </div>

        </nav>
    </header>

    <main id="main" class="container my-5" style="margin-top: 2rem;  width: 45rem;">
        <!-- USER'S POST -->
        <div class="mt-4">
            <h1>
                <Span id="username-span">Aiman's</Span>
                Post
            </h1>
        </div>
        <!-- // USER'S POSST // -->

        <!-- POST & COMMENT'S POST  -->
        <div class="card rounded-4 shadow-lg mt-5" id="post">
            <div class="card-header" style="display: flex;align-items: center;">
                <img src="./images/profile-logo.png" alt="" srcset="" style="width: 40px; height: 40px;">
                <h6 class="mx-2 mt-1">@Axjmr</h6>
            </div>

            <div class="card-body">
                <img src="./images/Cool wallpaper.jpeg" alt="" srcset="" style="width: 100%;">
                <h6 style="opacity: 50%;">2 min ago</h6>


                <h5 class="card-title">Hello world</h5>
                <p class="card-text">Lorem ipsum dolor sit amet consectetur adipisicing elit. Autem quod qui itaque!
                    Nemo optio, eum unde corrupti amet </p>

                <hr>

                <div>
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pen"
                        viewBox="0 0 16 16">
                        <path
                            d="m13.498.795.149-.149a1.207 1.207 0 1 1 1.707 1.708l-.149.148a1.5 1.5 0 0 1-.059 2.059L4.854 14.854a.5.5 0 0 1-.233.131l-4 1a.5.5 0 0 1-.606-.606l1-4a.5.5 0 0 1 .131-.232l9.642-9.642a.5.5 0 0 0-.642.056L6.854 4.854a.5.5 0 1 1-.708-.708L9.44.854A1.5 1.5 0 0 1 11.5.796a1.5 1.5 0 0 1 1.998-.001zm-.644.766a.5.5 0 0 0-.707 0L1.95 11.756l-.764 3.057 3.057-.764L14.44 3.854a.5.5 0 0 0 0-.708l-1.585-1.585z" />
                    </svg>
                    <span>(3) Comments</span>
                </div>
            </div>

            <!-- COMMENTS -->
            <div id="comments">
                <!-- COMMENT -->
                <div class="p-3" style="background-color: rgb(233, 232, 232);">

                    <!-- PROFILEMM PIC + USERNMAE -->
                    <div>
                        <img src="./images/profile-logo.png" alt="" id="profile_image" srcset=""
                            style="width: 30px; height: 30px;">
                        <b class="" id="user">Axjmr</b>
                    </div>
                    <!--// PROFILEMM PIC + USERNMAE //-->

                    <!-- COMMENT'S BODY -->
                    <div>
                        <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Incidunt a rerum laborum magnam
                            corrupti
                            doloremque vel, provident necessitatibus itaque modi, repellendus reiciendis omnis odit
                            consequatur, facilis consequuntur! Repellat, nostrum culpa.</p>
                    </div>
                    <!--// COMMENT'S BODY //-->
                    <hr>
                </div>
                <!--// COMMENT //-->
            </div>
            <!-- // COMMENTS //-->

            <!-- ADD COMMENT INPUT -->
            <div class="input-group mb-1" id="add-comment-div">
                <input id="comment-input" placeholder="add your comment here..." class="form-control">
                <button class="btn btn-outline-primary" type="button" onclick="creatComment()">Send</button>
            </div>
            <!--// ADD COMMENT INPUT //-->
        </div>
        <!--// POST & COMMENT'S POST //-->
    </main>
</body>

<script src="./mainLogic.js"></script>
<script>
    const urlParams = new URLSearchParams(window.location.search)
    const id = urlParams.get("postId")
    setupUI()
    getPost()
    // === Show one Post ===
    function getPost() {
        toggleLoader(true)
        axios.get(`${baseUrl}/posts/${id}`)
            .then((response) => {

                const post = response.data.data
                const comments = post.comments
                const author = post.author

                document.getElementById("username-span").innerHTML = `${author.username}'s`

                if (post.title == null) {
                    post.title = ""
                }

                let commentsContent = ``

                for (comment of comments) {
                    commentsContent += `
                        <div class="p-3" style="background-color: rgb(233, 232, 232);">

                            <!-- PROFILEMM PIC + USERNMAE -->
                            <div>
                                <img src="${comment.author.profile_image}" alt="" class="" id="profile_image" srcset=""
                                    style="width: 30px; height: 30px; border-radius: 50%;">
                                <b class="" id="user">${comment.author.username}</b>
                            </div>
                            <!--// PROFILEMM PIC + USERNMAE //-->

                            <!-- COMMENT'S BODY -->
                            <div>
                                <p>${comment.body}</p>
                            </div>
                            <!--// COMMENT'S BODY //-->
                            <hr>
                        </div>
                    `
                }
                const postContent =
                    `
                    <div>
                        <div class="card-header" style="display: flex;align-items: center;">
                            <img src="${author.profile_image}" alt="" srcset="" style="width: 40px; height: 40px;">
                            <h6 class="mx-2 mt-1">${author.username}</h6>
                        </div>

                        <div class="card-body">
                            <img src="${post.image}" alt="" srcset="" style="width: 100%;">
                            <h6 style="opacity: 50%;">${post.created_at}</h6>


                            <h5 class="card-title">${post.title}</h5>
                            <p class="card-text">${post.body} </p>

                            <hr>

                            <div>
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pen"
                                    viewBox="0 0 16 16">
                                    <path
                                        d="m13.498.795.149-.149a1.207 1.207 0 1 1 1.707 1.708l-.149.148a1.5 1.5 0 0 1-.059 2.059L4.854 14.854a.5.5 0 0 1-.233.131l-4 1a.5.5 0 0 1-.606-.606l1-4a.5.5 0 0 1 .131-.232l9.642-9.642a.5.5 0 0 0-.642.056L6.854 4.854a.5.5 0 1 1-.708-.708L9.44.854A1.5 1.5 0 0 1 11.5.796a1.5 1.5 0 0 1 1.998-.001zm-.644.766a.5.5 0 0 0-.707 0L1.95 11.756l-.764 3.057 3.057-.764L14.44 3.854a.5.5 0 0 0 0-.708l-1.585-1.585z" />
                                </svg>
                                <span>(${post.comments_count}) Comments</span>
                            </div>
                        </div>
                        
                        <div>
                            ${commentsContent}
                        </div>
                    
                            <div class="input-group mb-1" id="add-comment-div">
                                <input id="comment-input" placeholder="add your comment here..." class="form-control">
                                <button class="btn btn-outline-primary" type="button" onclick="creatComment()">Send</button>
                            </div>
                        
                    </div>
                `
                document.getElementById("post").innerHTML = postContent
            })
            .catch((error) => {
                showAlert(error.response.data.message, "danger")
            }).finally(() => {
                toggleLoader(false)
            })
    }


    // === Create A New Comment ===
    function creatComment() {
        let commentBody = document.getElementById("comment-input").value
        let params = {
            "body": commentBody
        }
        let token = localStorage.getItem("token")
        let url = `${baseUrl}/posts/${id}/comments`

        axios.post(url, params, {
            headers: {
                "authorization": `Bearer ${token}`
            }
        }).then((response) => {
            getPost()
            showAlert("Creat A New Comment Successfuly")
        }).catch((error) => {
            showAlert(error.response.data.message, "danger")
        })
    }

</script>

</html>